<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin ‚Äî CTF v6</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@700;900&display=swap');
:root{--g:#00ff41;--r:#ff4444;--gold:#ffd700}
*{margin:0;padding:0;box-sizing:border-box}
body{background:#050505;color:var(--g);font-family:'Share Tech Mono',monospace;min-height:100vh}
#LS{display:flex;align-items:center;justify-content:center;flex-direction:column;gap:14px;min-height:100vh}
#LS h2{font-family:'Orbitron',sans-serif;font-size:2em;text-shadow:0 0 20px var(--g)}
#AP{display:none}
.wp{max-width:1100px;margin:0 auto;padding:20px}
.tp{display:flex;align-items:center;justify-content:space-between;padding:13px 0 20px;border-bottom:1px solid rgba(0,255,65,.1);margin-bottom:20px;flex-wrap:wrap;gap:9px}
.tp h1{font-family:'Orbitron',sans-serif;font-size:1.4em;text-shadow:0 0 14px var(--g)}
.st{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:11px;margin-bottom:18px}
.sc{background:rgba(0,255,65,.04);border:1px solid rgba(0,255,65,.12);border-radius:10px;padding:13px;text-align:center}
.sv{font-family:'Orbitron',sans-serif;font-size:1.7em;color:var(--g)}
.sl{font-size:10px;opacity:.35;text-transform:uppercase;letter-spacing:1px;margin-top:3px}
.card{background:rgba(0,255,65,.03);border:1px solid rgba(0,255,65,.1);border-radius:11px;padding:17px;margin-bottom:17px}
.card h3{font-size:11px;text-transform:uppercase;letter-spacing:1px;opacity:.45;margin-bottom:11px}
input[type=text],input[type=password]{padding:9px 12px;background:rgba(0,0,0,.9);border:1.5px solid rgba(0,255,65,.2);border-radius:7px;color:var(--g);font-family:inherit;font-size:13px;outline:none;transition:.2s}
input[type=text]:focus,input[type=password]:focus{border-color:var(--g)}
.btn{padding:9px 15px;border:none;border-radius:7px;font-family:inherit;font-size:12px;font-weight:bold;cursor:pointer;transition:.2s}
.red{background:var(--r);color:#fff}.red:hover{background:#c00}
.grn{background:var(--g);color:#000}.grn:hover{background:#0c3}
.gh{background:transparent;border:1px solid rgba(0,255,65,.2);color:var(--g)}.gh:hover{background:rgba(0,255,65,.07)}
.sm{padding:4px 9px;font-size:11px;border-radius:5px}
.tabs{display:flex;gap:6px;margin-bottom:15px;flex-wrap:wrap}
.tab{padding:7px 13px;border:1px solid rgba(0,255,65,.16);border-radius:7px;cursor:pointer;font-size:12px;transition:.2s;user-select:none}
.tab.on,.tab:hover{background:var(--g);color:#000;font-weight:bold}
.pn{display:none}.pn.on{display:block}
table{width:100%;border-collapse:collapse;font-size:12px}
th{padding:7px 7px;text-align:left;border-bottom:1px solid rgba(0,255,65,.14);font-size:10px;text-transform:uppercase;letter-spacing:1px;opacity:.4}
td{padding:7px 7px;border-bottom:1px solid rgba(0,255,65,.05);vertical-align:middle}
tr:hover td{background:rgba(0,255,65,.02)}
.scr{max-height:350px;overflow-y:auto}
.ck{display:inline-block;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:bold}
.CLEAN,.LOW{color:var(--g);border:1px solid var(--g)}
.MEDIUM{color:#fa0;border:1px solid #fa0}
.HIGH{color:#f60;border:1px solid #f60}
.CRITICAL{color:var(--r);border:1px solid var(--r)}
.fd{max-height:210px;overflow-y:auto;background:#000;border:1px solid rgba(0,255,65,.08);border-radius:8px;padding:10px;font-size:11px;line-height:1.7}
.fs{color:var(--g)}.fb{color:var(--r)}.fa{color:var(--gold)}
#toast{position:fixed;top:16px;right:16px;padding:10px 16px;border-radius:8px;font-size:13px;display:none;z-index:9999;font-weight:bold}
</style>
</head>
<body>
<div id="LS">
  <h2>üõ°Ô∏è ADMIN ACCESS</h2>
  <input id="LPW" type="password" placeholder="Enter admin password" style="width:260px;padding:13px 15px;font-size:15px">
  <button class="btn grn" id="LBT" style="width:260px;padding:13px;font-size:14px">üîì LOGIN</button>
  <div id="LER" style="color:var(--r);font-size:13px;min-height:18px"></div>
</div>
<div id="AP">
<div class="wp">
  <div class="tp">
    <h1>üõ°Ô∏è ADMIN PANEL</h1>
    <div style="display:flex;gap:7px;flex-wrap:wrap">
      <a href="/" style="text-decoration:none"><button class="btn gh">‚Üê CTF</button></a>
      <button class="btn red sm" id="LOUT">Logout</button>
    </div>
  </div>
  <div class="st">
    <div class="sc"><div class="sv" id="sTot">-</div><div class="sl">Submissions</div></div>
    <div class="sc"><div class="sv" id="sAvg">-</div><div class="sl">Avg Score</div></div>
    <div class="sc"><div class="sv" id="sTop">-</div><div class="sl">Top Score</div></div>
    <div class="sc"><div class="sv" id="sBan">-</div><div class="sl">Banned IPs</div></div>
  </div>
  <div class="card">
    <h3>üö´ Ban IP Address</h3>
    <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <input type="text" id="bIP"  placeholder="IP Address"        style="flex:1;min-width:140px">
      <input type="text" id="bRS"  placeholder="Reason (optional)" style="flex:2;min-width:170px">
      <button class="btn red" id="bBT">üö´ BAN</button>
    </div>
  </div>
  <div class="tabs">
    <div class="tab on" id="T0">üìã Submissions</div>
    <div class="tab"    id="T1">üö´ Banned IPs</div>
    <div class="tab"    id="T2">üì° Request Log</div>
    <div class="tab"    id="T3">üî¥ Live Feed</div>
  </div>
  <div id="P0" class="pn on">
    <div class="card"><h3>All Submissions</h3>
      <div class="scr"><table>
        <thead><tr><th>ID</th><th>Name</th><th>Score</th><th>Rank</th><th>Crack</th><th>IP</th><th>Geo</th><th>Risk</th><th>Time</th><th>Actions</th></tr></thead>
        <tbody id="tS"><tr><td colspan="10" style="text-align:center;opacity:.3;padding:16px">Loading...</td></tr></tbody>
      </table></div>
    </div>
  </div>
  <div id="P1" class="pn">
    <div class="card"><h3>Banned IPs</h3>
      <div class="scr"><table>
        <thead><tr><th>IP</th><th>Reason</th><th>Time</th><th>Action</th></tr></thead>
        <tbody id="tB"><tr><td colspan="4" style="text-align:center;opacity:.3;padding:16px">No bans</td></tr></tbody>
      </table></div>
    </div>
  </div>
  <div id="P2" class="pn">
    <div class="card"><h3>Request Log</h3>
      <div class="scr"><table>
        <thead><tr><th>ID</th><th>IP</th><th>Method</th><th>Path</th><th>Time</th></tr></thead>
        <tbody id="tL"><tr><td colspan="5" style="text-align:center;opacity:.3;padding:16px">Loading...</td></tr></tbody>
      </table></div>
    </div>
  </div>
  <div id="P3" class="pn">
    <div class="card"><h3>Live Feed</h3>
      <div class="fd" id="FD"><span style="opacity:.4">Live feed not available on Netlify ‚Äî data auto-refreshes every 15s.</span></div>
    </div>
  </div>
</div>
</div>
<div id="toast"></div>
<script>
(function(){
  var TOKEN='';
  function e(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
  function ft(ts){try{return new Date(ts).toLocaleString();}catch(x){return String(ts||'?');}}
  function toast(msg,color){var el=document.getElementById('toast');el.textContent=msg;el.style.background=color;el.style.color=color==='#00ff41'?'#000':'#fff';el.style.display='block';setTimeout(function(){el.style.display='none';},3000);}
  function doLogin(){
    TOKEN=document.getElementById('LPW').value;
    if(!TOKEN){document.getElementById('LER').textContent='Enter password';return;}
    loadData().then(function(ok){
      if(ok){document.getElementById('LS').style.display='none';document.getElementById('AP').style.display='block';}
      else{document.getElementById('LER').textContent='‚ùå Wrong password';TOKEN='';}
    });
  }
  document.getElementById('LBT').addEventListener('click',doLogin);
  document.getElementById('LPW').addEventListener('keydown',function(ev){if(ev.key==='Enter')doLogin();});
  document.getElementById('LOUT').addEventListener('click',function(){TOKEN='';location.reload();});
  function loadData(){
    return fetch('/api/admin/data',{headers:{'x-admin-token':TOKEN}})
      .then(function(r){return r.json();})
      .then(function(d){
        if(!d.ok)return false;
        var s=d.stats||{};
        document.getElementById('sTot').textContent=s.total||0;
        document.getElementById('sAvg').textContent=s.avg||0;
        document.getElementById('sTop').textContent=s.top||0;
        document.getElementById('sBan').textContent=(d.banned||[]).length;
        renderSubs(d.subs||[]);renderBans(d.banned||[]);renderLogs(d.logs||[]);
        return true;
      }).catch(function(){return false;});
  }
  function renderSubs(rows){
    document.getElementById('tS').innerHTML=rows.length
      ?rows.map(function(r){return'<tr>'
          +'<td style="opacity:.3">'+r.id+'</td>'
          +'<td><strong>'+e(r.name)+'</strong></td>'
          +'<td style="color:#0f4;font-weight:bold">'+r.score+'</td>'
          +'<td style="font-size:11px">'+e(r.rank||'')+'</td>'
          +'<td style="opacity:.55">'+e(r.crack||'?')+'</td>'
          +'<td style="font-size:11px">'+e(r.ip||'')+'</td>'
          +'<td style="opacity:.45">'+e(r.geo||'?')+'</td>'
          +'<td><span class="ck '+(r.risk||'LOW')+'">'+e(r.risk||'?')+'</span></td>'
          +'<td style="opacity:.3;font-size:10px">'+ft(r.ts)+'</td>'
          +'<td style="white-space:nowrap">'
          +'<button class="btn red sm" data-ban-ip="'+e(r.ip)+'" data-ban-name="'+e(r.name)+'">üö´</button> '
          +'<button class="btn gh sm" data-del="'+r.id+'">üóëÔ∏è</button>'
          +'</td></tr>';}).join('')
      :'<tr><td colspan="10" style="text-align:center;opacity:.3;padding:16px">No submissions</td></tr>';
    document.querySelectorAll('[data-ban-ip]').forEach(function(btn){
      btn.addEventListener('click',function(){
        var ip=this.getAttribute('data-ban-ip'),name=this.getAttribute('data-ban-name');
        if(!confirm('Ban IP '+ip+' ('+name+')?'))return;
        apiPost('/api/admin/ban',{ip:ip,reason:'Banned from submission: '+name},function(d){
          toast(d.ok?'üö´ Banned '+ip:'Error: '+(d.error||'?'),d.ok?'#f44':'#f80');
          if(d.ok)loadData();
        });
      });
    });
    document.querySelectorAll('[data-del]').forEach(function(btn){
      btn.addEventListener('click',function(){
        var id=this.getAttribute('data-del');
        if(!confirm('Delete submission #'+id+'?'))return;
        apiPost('/api/admin/delete',{id:id},function(d){
          toast(d.ok?'üóëÔ∏è Deleted':'Error: '+(d.error||'?'),d.ok?'#fa0':'#f44');
          if(d.ok)loadData();
        });
      });
    });
  }
  function renderBans(rows){
    document.getElementById('tB').innerHTML=rows.length
      ?rows.map(function(r){return'<tr>'
          +'<td style="color:var(--r);font-weight:bold">'+e(r.ip)+'</td>'
          +'<td style="opacity:.5">'+e(r.reason||'‚Äî')+'</td>'
          +'<td style="opacity:.3;font-size:10px">'+ft(r.ts)+'</td>'
          +'<td><button class="btn grn sm" data-unban="'+e(r.ip)+'">‚úÖ Unban</button></td>'
          +'</tr>';}).join('')
      :'<tr><td colspan="4" style="text-align:center;opacity:.3;padding:16px">No bans</td></tr>';
    document.querySelectorAll('[data-unban]').forEach(function(btn){
      btn.addEventListener('click',function(){
        var ip=this.getAttribute('data-unban');
        if(!confirm('Unban '+ip+'?'))return;
        apiPost('/api/admin/unban',{ip:ip},function(d){
          toast(d.ok?'‚úÖ Unbanned '+ip:'Error: '+(d.error||'?'),d.ok?'#0f4':'#f80');
          if(d.ok)loadData();
        });
      });
    });
  }
  function renderLogs(rows){
    document.getElementById('tL').innerHTML=rows.length
      ?rows.map(function(r){return'<tr>'
          +'<td style="opacity:.3">'+r.id+'</td>'
          +'<td style="font-size:11px">'+e(r.ip||'')+'</td>'
          +'<td style="opacity:.4">'+e(r.method||'')+'</td>'
          +'<td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;opacity:.55">'+e(r.path||'')+'</td>'
          +'<td style="opacity:.3;font-size:10px">'+ft(r.ts)+'</td>'
          +'</tr>';}).join('')
      :'<tr><td colspan="5" style="text-align:center;opacity:.3;padding:16px">No logs</td></tr>';
  }
  document.getElementById('bBT').addEventListener('click',function(){
    var ip=document.getElementById('bIP').value.trim();
    var reason=document.getElementById('bRS').value.trim();
    if(!ip){toast('Enter an IP','#f44');return;}
    apiPost('/api/admin/ban',{ip:ip,reason:reason},function(d){
      toast(d.ok?'üö´ Banned '+ip:'Error: '+(d.error||'?'),d.ok?'#f44':'#f80');
      if(d.ok){document.getElementById('bIP').value='';document.getElementById('bRS').value='';loadData();}
    });
  });
  [0,1,2,3].forEach(function(i){
    document.getElementById('T'+i).addEventListener('click',function(){
      [0,1,2,3].forEach(function(j){
        document.getElementById('T'+j).classList.toggle('on',j===i);
        var p=document.getElementById('P'+j);
        p.classList.toggle('on',j===i);
        p.style.display=j===i?'block':'none';
      });
    });
  });
  function apiPost(url,body,cb){
    fetch(url,{method:'POST',headers:{'Content-Type':'application/json','x-admin-token':TOKEN},body:JSON.stringify(body)})
      .then(function(r){return r.json();}).then(cb)
      .catch(function(){cb({ok:false,error:'Network error'});});
  }
  [0,1,2,3].forEach(function(i){document.getElementById('P'+i).style.display=i===0?'block':'none';});
  setInterval(loadData,15000);
})();
</script>
</body>
</html>
